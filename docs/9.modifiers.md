# Modifiers

## Overview

Modifiers from [@ajs/database-decorators](https://github.com/AntelopeJS/database-decorators)
work automatically. However, some modifiers require runtime parameters, which can be configured in your Data API controller.

For modifiers that require runtime parameters, use the `@ModifierKey` decorator.

## ModifierKey Decorator

### When to Use

The `@ModifierKey` decorator is needed for modifiers that require runtime parameters, such as
`LocalizationModifier` which needs a locale identifier.

It must be combined with `@Parameter` to specify where the modifier key value comes from (HTTP headers, query params, etc.).

```typescript
import { ModifierKey } from '@ajs/data-api/beta/metadata';
import { Parameter } from '@ajs/data-api/beta/components';
import { Localized, LocalizationModifier } from '@ajs/database-decorators/beta';
```

### Usage

```typescript
@RegisterTable('content')
class Content extends Table.with(LocalizationModifier) {
  @Index({ primary: true })
  declare _id: string;

  @Localized()
  declare title: string;

  @Localized()
  declare description: string;
}

@RegisterDataController()
class ContentAPI extends DataController(Content, DefaultRoutes.All, Controller('/content')) {
  @ModelReference()
  @StaticModel(ContentModel, 'my-database')
  declare contentModel: ContentModel;

  @Parameter('x-content-language', 'header')
  @ModifierKey(LocalizationModifier)
  declare language: string;

  @Listable()
  @Access(AccessMode.ReadWrite)
  declare title: string;

  @Listable()
  @Access(AccessMode.ReadWrite)
  declare description: string;
}
```

### How It Works

1. HTTP request includes header: `x-content-language: fr`
2. The `language` property receives the value `'fr'`
3. When writing data, the modifier uses `'fr'` as the key to store localized values
4. When reading data, the modifier uses `'fr'` to retrieve the correct localized value

**Example request:**
```http
POST /content/new
x-content-language: fr
Content-Type: application/json

{
  "title": "Titre en français",
  "description": "Description en français"
}
```

The data is stored with `'fr'` as the locale key. Later requests with `x-content-language: en` would access different localized values.

**Note**: Most modifiers (like `@Hashed`, `@Encrypted`) do not require `@ModifierKey`. 
See the [@ajs/database-decorators documentation](https://github.com/AntelopeJS/database-decorators)
for details on which modifiers require runtime parameters.

## Integration with Other Features

### Foreign Keys

Modifiers work automatically with foreign key relationships. Foreign objects with modifier-protected
fields are properly handled during retrieval. See [foreign keys documentation](./7.foreign-keys.md).

### Filters

When filtering modifier-protected fields, use the `proxy` parameter in custom filter functions.
See [filters documentation](./8.filters.md) for details.

## Learn More

For complete information on available modifiers and creating custom ones, see the
[@ajs/database-decorators documentation](https://github.com/AntelopeJS/database-decorators).