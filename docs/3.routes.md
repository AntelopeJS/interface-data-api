# Routes

## Overview

Routes defines which operations are available for your data controllers.
The module provides predefined route configurations that automatically generate endpoints
with proper methods and parameter handling.

## Default Routes

The framework provides a set of predefined routes that cover all common CRUD operations:

### Available Route Types

```typescript
import { DefaultRoutes } from '@ajs/data-api/beta';

// Individual routes
const routes = {
  get: DefaultRoutes.Get,       // GET /resource/get?id=:id
  list: DefaultRoutes.List,     // GET /resource/list
  new: DefaultRoutes.New,       // POST /resource/new
  edit: DefaultRoutes.Edit,     // PUT /resource/edit/:id
  delete: DefaultRoutes.Delete, // DELETE /resource/delete?id=:id
}

// All routes combined
DefaultRoutes.All
```

### Route Configuration

You can use the `DefaultRoutes` to configure your data controller with all available routes or a subset of them.

```typescript
const allRoutes = DefaultRoutes.All;

@RegisterDataController()
class routeExample extends DataController(User, allRoutes, Controller(`/${testName}`)) {
  // ...
}

// Enable specific routes only
const someRoutes = {
  get: DefaultRoutes.Get,
  list: DefaultRoutes.List,
  new: DefaultRoutes.New
};

@RegisterDataController()
class routeExample extends DataController(User, someRoutes, Controller(`/${testName}`)) {
  // edit and delete routes will not be created
}
```

## Default route parameters

Each default route type accepts specific parameters and generates appropriate endpoints:

### Get Route

Retrieves a single record by ID.

**Endpoint:** `GET /resource/get`

**Query Parameters:**
- `id` (required): Record identifier

**Example:**
```http
GET /customers/get?id=customer-123
```

**Response:**
```json
{
  "_id": "customer-123",
  "name": "Bob",
  "email": "bob@example.com"
}
```

### List Route

Retrieves multiple records with filtering, sorting, and pagination.

**Endpoint:** `GET /resource`

**Query Parameters:**
- `limit` (optional): Maximum number of records (default: 100)
- `offset` (optional): Number of records to skip
- `sortKey` (optional): Field to sort by
- `sortDirection` (optional): Sort direction ('asc' or 'desc')
- `maxPage` (optional): Maximum page size override

**Example:**
```http
GET /customers?limit=10&offset=0&sortKey=firstName&sortDirection=asc&isActive=true
```

**Response:**
```json
{
  "results": [
    {
      "_id": "customer-123",
      "name": "bob",
      "email": "bob@example.com",
      "isActive": true
    },
    // More records...
  ],
  "total": 1,
  "offset": 0,
  "limit": 10
}
```

### New Route

Create one or more new records and return their newly created IDs.

**Endpoint:** `POST /resource/new`

**Body:** JSON array of records to create

**Example:**
```http
POST /customers
Content-Type: application/json

[
  {
    "name": "Bob",
    "email": "bob@example.com",
    "age": 30
  }
]
```

**Response:**
```json
["customer-123"]
```

### Edit Route

Updates an existing record by ID. On success, will not return a message.

**Endpoint:** `PUT /resource/edit`

**Parameters:**
- `id` (required): Record identifier

**Body:** JSON object with fields to update

**Example:**
```http
PUT /customers/edit?id=customer-123
Content-Type: application/json

{
  "name": "Bob",
  "email": "bob@example.com",
  "age": 31
}
```

**Response:**
```http
200 OK
```

### Delete Route

Delete a record by ID. On success, will not return a message.

**Endpoint:** `DELETE /resource/delete`

**Parameters:**
- `id` (required): Record identifier

**Example:**
```http
DELETE /customers/delete?id=customer-123
```

**Response:**
```http
200 OK
```

## Route Options

Routes can be customized with options to modify their behavior:

### WithOptions Function

With this function you can set both query parameters and additional route settings.

```typescript
import { DefaultRoutes } from '@ajs/data-api/beta';

// Disable mandatory field validation for edit route
const editRoutes = { 
  my_route: DefaultRoutes.WithOptions(DefaultRoutes.Edit, { noMandatory: 'true' }),
  edit: DefaultRoutes.Edit,
};

@RegisterDataController()
class routeExample extends DataController(User, editRoutes, Controller(`/${testName}`)) {
  // This will create a regular /users/edit route with mandatory field validation, and
  // a custom /users/my_route that ignore them.
}
```

### Additional Route Settings

These parameters can only be changed through the `WithOptions` function.

**Get Settings:**
- `index`: Index to use instead of the primary key
- `noForeign`: Don't resolve foreign keys

**List Settings:**
- `maxPage`: Max value for the `limit` parameter
- `noForeign`: Don't resolve foreign keys
- `noPluck`: Skip the pluck step, return every key from the database.
- `pluckMode`: Pluck mode to use (see mode parameter of @Listable)

**New Settings:**
- `noMandatory`: Skip the mandatory field validation step

**Edit Settings:**
- `index`: Index to use instead of the primary key
- `noMandatory`: Skip the mandatory field validation step

## Custom Route Implementation

For advanced use cases, you can implement custom routes:

```typescript
import { DataController, RegisterDataController, DefaultRoutes } from '@ajs/data-api/beta';
import { Parameters } from '@ajs/data-api/beta/components';
import { Controller, Context } from '@ajs/api/beta';

const Search = {
  // Route callback:
  func: async (ctx, params) => {
    // Custom search implementation
    const { query } = params;
    // ... search logic
    return results;
  },
  // Parameter decorators have to go into an `args` array:
  args: [Context(), Parameters.List()],
  method: 'GET'
}

@RegisterDataController()
class CustomUserAPI extends DataController(User, {
  delete: DefaultRoutes.Delete,
  search: Search
}, Controller('/users')) {
  // Field definitions...
}
```

## Error Handling

Default routes handle common error scenarios:

- **404 Not Found**: When a record doesn't exist
- **400 Bad Request**: When validation fails
- **500 Internal Server Error**: When database operations fail

It will also return a **plaintext** error message in the response body, explaining what went wrong.

## Continuing with Access Rights
See the [access rights documentation](./4.access-rights.md) to learn how to
control field read/write permissions and customize route behavior.