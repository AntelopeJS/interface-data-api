# Parameter Handling

The Data API provides default parameter providers for the different types of CRUD operations. These parameter providers extract and validate request parameters to ensure they're ready for use in the default endpoint handlers.

## Available Parameter Providers

### List Parameters

Used for list/search endpoints:

```typescript
import { Context, RequestContext } from "@ajs/api/beta";
import { Parameters } from "@ajs/data-api/beta/components";
import { MyTable } from "db/t_my_table.ts";
import { Logging } from "@ajs/logging/beta";

class MyDataAPI {
  async list(
    @Context() ctx: RequestContext,
    @Parameters.List() params: Parameters.ListParameters
  ) {
    // params is a ListParameters object
    Logging.Info(params.limit, params.offset, params.sortKey);
    // ...
  }
}
```

The `ListParameters` interface includes:

```typescript
interface ListParameters {
  filters?: Record<string, FilterValue>; // Applied filters
  offset?: number; // Pagination offset
  limit?: number; // Pagination limit
  sortKey?: string; // Field to sort by
  sortDirection?: "asc" | "desc"; // Sort direction
  maxPage?: number; // Maximum items per page
  noForeign?: boolean; // Skip foreign key resolution
  noPluck?: boolean; // Skip field plucking
  pluckMode?: string; // Pluck mode to use
}
```

#### List Parameter URL Query Format

When making requests to list endpoints, the following query parameters can be used:

- `offset=20` - Start at the 20th record
- `limit=50` - Return up to 50 records
- `sortKey=price` - Sort by the price field
- `sortDirection=desc` - Sort in descending order
- `filter_article=eq:Book` - Filter where article equals "Book"

#### Filtering

The filters use a specific format for comparison operations:

- `filter_[fieldName]=[operation]:[value]`

Available comparison operations for the default filter function:

- `eq` - Equals
- `ne` - Not equals
- `gt` - Greater than
- `ge` - Greater than or equal
- `lt` - Less than
- `le` - Less than or equal

Examples:

- `filter_price=gt:100` - Price greater than 100
- `filter_article=eq:Book` - Article equals "Book"

Multiple filters can be combined:

```
GET /api/my-endpoint?filter_price=gt:100&filter_article=eq:Book&sortKey=price
```

### Get Parameters

Used for retrieving a single record:

```typescript
import { Context, RequestContext } from "@ajs/api/beta";
import { Parameters } from "@ajs/data-api/beta/components";
import { MyTable } from "db/t_my_table.ts";
import { Logging } from "@ajs/logging/beta";

class MyDataAPI {
  async get(
    @Context() ctx: RequestContext,
    @Parameters.Get() params: Parameters.GetParameters
  ) {
    // params is a GetParameters object
    Logging.Info(params.id, params.index);
    // ...
  }
}
```

The `GetParameters` interface includes:

```typescript
interface GetParameters {
  id: string; // Record ID
  index?: string; // Optional index name
  noForeign?: string; // Skip foreign key resolution
}
```

### New Parameters

Used for creating new records:

```typescript
import { Context, RequestContext, RawBody } from "@ajs/api/beta";
import { Parameters } from "@ajs/data-api/beta/components";
import { MyTable } from "db/t_my_table.ts";
import { Logging } from "@ajs/logging/beta";

class MyDataAPI {
  async create(
    @Context() ctx: RequestContext,
    @Parameters.New() params: Parameters.NewParameters,
    @RawBody() body: Buffer
  ) {
    // params is a NewParameters object
    Logging.Info(params.noMandatory);
    // ...
  }
}
```

The `NewParameters` interface includes:

```typescript
interface NewParameters {
  noMandatory?: string; // Skip mandatory field checks
}
```

#### New Parameter Request Format

When creating new records, the request should use:

- **Method**: POST
- **URL**: `/api/my-endpoint/new`
- **Content-Type**: application/json
- **Body**: JSON object with field values

Example:

```json
{
  "article": "Book",
  "price": 42
}
```

### Edit Parameters

Used for updating existing records:

```typescript
import { Context, RequestContext, RawBody } from "@ajs/api/beta";
import { Parameters } from "@ajs/data-api/beta/components";
import { MyTable } from "db/t_my_table.ts";
import { Logging } from "@ajs/logging/beta";

class MyDataAPI {
  async edit(
    @Context() ctx: RequestContext,
    @Parameters.Edit() params: Parameters.EditParameters,
    @RawBody() body: Buffer
  ) {
    // params is an EditParameters object
    Logging.Info(params.id, params.index, params.noMandatory);
    // ...
  }
}
```

The `EditParameters` interface includes:

```typescript
interface EditParameters {
  id: string; // Record ID
  index?: string; // Optional index name
  noMandatory?: string; // Skip mandatory field checks
}
```

#### Edit Parameter Request Format

When updating records, the request should use:

- **Method**: PUT
- **URL**: `/api/my-endpoint/edit?id=123`
- **Content-Type**: application/json
- **Body**: JSON object with fields to update

Example:

```json
{
  "article": "Book",
  "price": 55
}
```

### Delete Parameters

Used for deleting records:

```typescript
import { Context, RequestContext } from "@ajs/api/beta";
import { Parameters } from "@ajs/data-api/beta/components";
import { MyTable } from "db/t_my_table.ts";
import { Logging } from "@ajs/logging/beta";

class MyDataAPI {
  async delete(
    @Context() ctx: RequestContext,
    @Parameters.Delete() params: Parameters.DeleteParameters
  ) {
    // params is a DeleteParameters object
    Logging.Info(params.id); // Array of IDs
    // ...
  }
}
```

The `DeleteParameters` interface includes:

```typescript
interface DeleteParameters {
  id: string[]; // Array of record IDs to delete
}
```

#### Delete Parameter Request Format

When deleting records, the request should use:

- **Method**: DELETE
- **URL**: `/api/my-endpoint/delete?id=123&id=456&id=789`

The IDs are provided as multiple query parameters with the same name.

## Forced Parameters

Parameters can have default values that can be overridden in route definitions:

```typescript
const CustomRoutes = {
  list: DefaultRoutes.WithOptions(DefaultRoutes.List, {
    limit: 20, // Set default limit to 20
    maxPage: 50, // Set maximum page size to 50
    noForeign: true, // Skip foreign key resolution by default
  }),
};

@RegisterDataController()
export class MyDataAPI extends DataController(
  MyTable,
  CustomRoutes,
  Controller("/my-endpoint")
) {
  // ...
}
```
